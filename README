-----------------------------------------------------------------------------
AGPLv3 tool to create networks of kvm virtual machines.
See directory cloonix for the LICENCE
See clownix.net for a documentation (which is not up to date).

NOTE: The version 18-00 had a default interface for virtual machines with
      an integrated spy. That features limits the total number of interfaces.
      The version 18-01 has no spy for the vm but has no limitations.
      The integrated wireshark spy will be corrected in next cloonix version.

-----------------------------------------------------------------------------
DOWNLOADS:

http://clownix.net/downloads/cloonix-18-01

-----------------------------------------------------------------------------
COMPILED AND TESTED ON:

            bullseye (debian 11),
            hirsute (ubuntu 21.04),
            tumbleweed (rolling opensuse),
            centos8,
            fedora34.


Compilation and run should work, on the above but for other distributions,
you may have to adjust needed packages, look in file install_depends for
hints on necessary packages.

-----------------------------------------------------------------------------
INSTALL:

wget http://clownix.net/downloads/cloonix-18-01/cloonix-v18-01.tar.gz
tar xvf cloonix-v18-01.tar.gz
cd cloonix-v18-01
sudo ./install_depends

wget http://clownix.net/downloads/cloonix-18-01/targz_store.tar.gz
tar xvf targz_store.tar.gz

./doitall

-----------------------------------------------------------------------------
GET A WORKING VM:

wget http://clownix.net/downloads/cloonix-18-01/bulk/bullseye.qcow2.gz

mkdir -p ${HOME}/cloonix_data/bulk
cp bullseye.qcow2.gz ${HOME}/cloonix_data/bulk
cd ${HOME}/cloonix_data/bulk
gunzip bullseye.qcow2.gz

-----------------------------------------------------------------------------
REQUIRED HOST CUSTOM

Check that your cpu is equiped with the necessary option:
egrep -c '(vmx|svm)' /proc/cpuinfo
The result must be non-zero

The host must have 1 Giga size hugepages.
For this configuration, put in "/etc/default/grub":

GRUB_CMDLINE_LINUX="kvm-intel.nested=1 default_hugepagesz=1G hugepagesz=1G hugepages=5"
Then "update-grub" or "grub2-mkconfig --output=/boot/grub2/grub.cfg"

To check:
mount |grep hugepages
grep Huge /proc/meminfo

-----------------------------------------------------------------------------
LAUNCH:

cd cloonix/quickstart
./ping.sh

In this demo, the vms are launched with an "s" interface, this interface
permits to have wireshark upon a double-click on an interface.
The number of "s" interfaces in a cloonix is limited, use the "d" interface
when the spy is not used.
Note: s or d can be found in the PARAM definition in the ping.sh file: 
PARAMS="ram=2000 cpu=2 eth=s"

wireshark problems: wireshark is called from the gui software, it must be
installed to be usable by non-root user.
On debian the way to go is:
echo "wireshark-common wireshark-common/install-setuid boolean true" > preseed
sudo debconf-set-selections preseed
sudo dpkg-reconfigure  wireshark
sudo adduser ${USER} wireshark

-----------------------------------------------------------------------------
CISCO DEMO:

After cloonix install, go in "tools/cisco" directory and execute
the 3 steps to have a cisco network running ospf.
You have to be patient, ciscos are very long to start.

-----------------------------------------------------------------------------
MIKROTIK DEMO:

After cloonix install, go in "tools/mikrotik" directory and execute steps.

-----------------------------------------------------------------------------
WIRESHARK:

wireshark problems: Make wireshark usable by non-root user, on debian the way
to go is for debian:
echo "wireshark-common wireshark-common/install-setuid boolean true" > preseed
sudo debconf-set-selections preseed
sudo dpkg-reconfigure  wireshark
sudo adduser ${USER} wireshark

-----------------------------------------------------------------------------
NESTED CLOONIX:

If you need the nested function of kvm, to put a cloonix network inside a
cloonix vm guest, you can test if you have the necessary config:

cat /sys/module/kvm_intel/parameters/nested

If you do not have Y after this cat, then you can do:

GRUB_CMDLINE_LINUX="kvm-intel.nested=1 default_hugepagesz=1G hugepagesz=1G hugepages=5 kvm-intel.nested=1"

-----------------------------------------------------------------------------

