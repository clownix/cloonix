-----------------------------------------------------------------------------
AGPLv3 tool to create networks of kvm virtual machines.
See directory cloonix for the LICENCE
See clownix.net for a documentation (which is not up to date).

NOTE: The version 20-00 has 3 possible uses of ovs for a vm interface:
      s, d or v, s gives blinking interfaces that are spyable, d is for
      the dpdk interface not spyable and v is for vhost interface not
      spyable.
      A double-click on a spyable interface launches wireshark for this
      interface.
      The a2b, d2d and tap cloonix objects must be used with the spyable
      interface. Fast interfaces are d and v, the v (vhost) can also
      be used to get a faster tap named:
      "vho_<cloonix_rank>_<vmi_dx>_<eth_num>"
      As an example, the vhost (ie tap) interface created for the first
      vm of the nemo network and ethernet 0 is: "vho_1_1_0".

-----------------------------------------------------------------------------
DOWNLOADS:

http://clownix.net/downloads/cloonix-20-00

-----------------------------------------------------------------------------
COMPILED AND TESTED ON:

            bookworm (debian 12),
            bullseye (debian 11),
            impish  (ubuntu 21.10),
            hirsute (ubuntu 21.05),
            tumbleweed (rolling opensuse),
            fedora35.

WARNING: does not compile on centos8, too old spice-protocol version and
does not seem to compile on impish for the moment.


Compilation and run should work, on the above but for other distributions,
you may have to adjust needed packages, look in file install_depends for
hints on necessary packages.

-----------------------------------------------------------------------------
INSTALL:

wget http://clownix.net/downloads/cloonix-20-00/cloonix-20-00.tar.gz
tar xvf cloonix-20-00.tar.gz
cd cloonix-20-00
sudo ./install_depends

wget http://clownix.net/downloads/cloonix-20-00/targz_store.tar.gz
tar xvf targz_store.tar.gz

./doitall

-----------------------------------------------------------------------------
GET A WORKING VM:

wget http://clownix.net/downloads/cloonix-20-00/bulk/bullseye.qcow2.gz

mkdir -p ${HOME}/cloonix_data/bulk
cp bullseye.qcow2.gz ${HOME}/cloonix_data/bulk
cd ${HOME}/cloonix_data/bulk
gunzip bullseye.qcow2.gz

-----------------------------------------------------------------------------
REQUIRED HOST CUSTOM

Check that your cpu is equiped with the necessary option:
egrep -c '(vmx|svm)' /proc/cpuinfo
The result must be non-zero

The host must have 1 Giga size hugepages.
For this configuration, put in "/etc/default/grub":

GRUB_CMDLINE_LINUX="kvm-intel.nested=1 default_hugepagesz=1G hugepagesz=1G hugepages=5"
Then "update-grub" or "grub2-mkconfig --output=/boot/grub2/grub.cfg"

To check:
mount |grep hugepages
grep Huge /proc/meminfo

-----------------------------------------------------------------------------
LAUNCH:

cd cloonix/quickstart
./ping.sh

In this demo, the vms are launched with an "s" interface, this interface
permits to have wireshark upon a double-click on an interface.
The number of "s" interfaces in a cloonix is limited, use the "d" interface
when the spy is not used.
Note: s or d can be found in the PARAM definition in the ping.sh file: 
PARAMS="ram=2000 cpu=2 eth=s"

wireshark problems: wireshark is called from the gui software, it must be
installed to be usable by non-root user.
On debian the way to go is:
echo "wireshark-common wireshark-common/install-setuid boolean true" > preseed
sudo debconf-set-selections preseed
sudo dpkg-reconfigure  wireshark
sudo adduser ${USER} wireshark

-----------------------------------------------------------------------------
CISCO DEMO:

After cloonix install, go in "tools/cisco" directory and execute
the 3 steps to have a cisco network running ospf.
You have to be patient, ciscos are very long to start.

-----------------------------------------------------------------------------
MIKROTIK DEMO:

After cloonix install, go in "tools/mikrotik" directory and execute steps.

-----------------------------------------------------------------------------
WIRESHARK:

wireshark problems: Make wireshark usable by non-root user, on debian the way
to go is for debian:
echo "wireshark-common wireshark-common/install-setuid boolean true" > preseed
sudo debconf-set-selections preseed
sudo dpkg-reconfigure  wireshark
sudo adduser ${USER} wireshark

-----------------------------------------------------------------------------
NESTED CLOONIX:

If you need the nested function of kvm, to put a cloonix network inside a
cloonix vm guest, you can test if you have the necessary config:

cat /sys/module/kvm_intel/parameters/nested

If you do not have Y after this cat, then you can do:

GRUB_CMDLINE_LINUX="kvm-intel.nested=1 default_hugepagesz=1G hugepagesz=1G hugepages=5 kvm-intel.nested=1"

-----------------------------------------------------------------------------

