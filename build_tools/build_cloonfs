#!/bin/bash
#----------------------------------------------------------------------------#
set -e
#----------------------------------------------------------------------------#
BUNDLE="${HOME}/cloonix_bundle"
if [ ! -e ${BUNDLE}/cloonix/cloonix_config ]; then
  echo NOT FOUND:
  echo ${BUNDLE}/cloonix/cloonix_config
  exit 1
fi
CLOONSRC=${BUNDLE}/cloonix/cloonsrc
#----------------------------------------------------------------------------#
echo "\n\nBUILDING CLOONSRC\n\n" > /tmp/buildlog.txt
echo "\n\nBUILDING CLOONSRC\n\n" > /tmp/buildlog.err
printf "\n\nBUILDING CLOONSRC\n\n"
#----------------------------------------------------------------------------#
for i in "lib_io_clownix" \
         "lib_rpc_clownix" \
         "lib_utils" \
         "lib_rpc_doors" \
         "lib_rpc_layout" ; do

    cd ${CLOONSRC}/${i}
    echo
    echo DOING:
    echo ${CLOONSRC}/${i}
    echo ${CLOONSRC}/${i} >>/tmp/buildlog.txt
    echo ${CLOONSRC}/${i} >>/tmp/buildlog.err
    echo
    echo
    ./cmd 1>>/tmp/buildlog.txt 2>>/tmp/buildlog.err
done
#----------------------------------------------------------------------------#
printf "\n\nBUILDING CLOONSRC\n\n"
#----------------------------------------------------------------------------#
for i in  "hide_dirs" \
          "cloonix_dropbear" \
          "lib_client" \
          "ctrl" \
          "xwycli" \
          "rxvt" \
          "cairo_canvas" ; do
    echo
    echo DOING:
    echo ${CLOONSRC}/${i}
    echo ${CLOONSRC}/${i} >>/tmp/buildlog.txt
    echo ${CLOONSRC}/${i} >>/tmp/buildlog.err
    echo
    echo
    cd ${CLOONSRC}/${i}
    ./cmd 1>>/tmp/buildlog.txt 2>>/tmp/buildlog.err
done
#----------------------------------------------------------------------------#
printf "\n\nBUILDING CLOONSRC\n\n"
#----------------------------------------------------------------------------#
  echo DOING:
  echo ${CLOONSRC}/frr
  echo ${CLOONSRC}/frr >>/tmp/buildlog.txt
  echo ${CLOONSRC}/frr >>/tmp/buildlog.err
  echo
  echo
  cd ${CLOONSRC}/frr
  ./cmd 1>>/tmp/buildlog.txt 2>>/tmp/buildlog.err

  for i in  "vwifi" \
            "erase_workdir" \
            "apk_tools" \
            "xorg" \
            "wireshark" \
            "iproute2" \
            "crun" \
            "dtach" \
            "proxymous" \
            "xwy" \
            "wm2" \
            "ovs" \
            "nginx" \
            "doorways" \
            "suid_power" \
            "uml_cloonix_switch" \
            "ovs_drv" \
            "ovs_snf" \
            "ovs_nat_main" \
            "ovs_a2b" \
            "ovs_c2c" ; do
    echo
    echo DOING:
    echo ${CLOONSRC}/${i}
    echo ${CLOONSRC}/${i} >>/tmp/buildlog.txt
    echo ${CLOONSRC}/${i} >>/tmp/buildlog.err
    echo
    echo
    cd ${CLOONSRC}/${i}
    ./cmd 1>>/tmp/buildlog.txt 2>>/tmp/buildlog.err
  done
#----------------------------------------------------------------------------#
  for i in  "openssh" \
            "spice" \
            "spice_lib_client"; do
      echo
      echo DOING:
      echo ${CLOONSRC}/${i}
      echo ${CLOONSRC}/${i} >>/tmp/buildlog.txt
      echo ${CLOONSRC}/${i} >>/tmp/buildlog.err
      echo
      echo
      cd ${CLOONSRC}/${i}
      ./cmd 1>>/tmp/buildlog.txt 2>>/tmp/buildlog.err
  done

  for i in  "spice_lib_server" \
            "qemu"; do
    echo
    echo DOING:
    echo ${CLOONSRC}/${i}
    echo ${CLOONSRC}/${i} >>/tmp/buildlog.txt
    echo ${CLOONSRC}/${i} >>/tmp/buildlog.err
    echo
    echo
    cd ${CLOONSRC}/${i}
    ./cmd 1>>/tmp/buildlog.txt 2>>/tmp/buildlog.err
  done

#----------------------------------------------------------------------------#
  echo DOING:
  echo ${CLOONSRC}/create_insider_agents_iso
  echo ${CLOONSRC}/create_insider_agents_iso >>/tmp/buildlog.txt
  echo ${CLOONSRC}/create_insider_agents_iso >>/tmp/buildlog.err
  cd ${CLOONSRC}/create_insider_agents_iso
  ./cmd_mk_iso 1>>/tmp/buildlog.txt 2>>/tmp/buildlog.err
#----------------------------------------------------------------------------#
printf "\n\nBUILDING ALL OK\n\n"
printf "\n\nBUILDING ALL OK\n\n" >>/tmp/buildlog.txt
printf "\n\nBUILDING ALL OK\n\n" >>/tmp/buildlog.err
#----------------------------------------------------------------------------#
